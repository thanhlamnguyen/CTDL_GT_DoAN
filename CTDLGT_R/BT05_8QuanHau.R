library(tidyverse)

#-----------------------------------------------------------------------------
#' D???t m???t quân h???u cho tru???c m???t vecto v??? trí c???a các quân h???u hi???n t???i
#'
#' Hàm này t??? g???i d??? quy cho m???i v??? trí h???p l??? c???a quân h???u ti???p theo
#'
#' M???t vecto s??? nguyên d???i di???n cho v??? trí c???t c???a các quân h???u cho d???n nay.
#' Ch??? m???c trong danh sách này là hàng và giá tr??? là c???t.
#' D??? t???o t???t c??? các gi???i pháp, hãy chuy???n vào m???t vecto tr???ng (m???c d???nh)
#'
#'  Ví d??? quân h???u = c(1, 4, 7) tuong ???ng v???i các quân h???u du???c d???t t???i c(1, 1), c(2, 4) và c(3, 7)
#'                  
#'
#'    (C???t)   
#'      8  |   |   |   |   |   |   |   |   |
#'      | ---------------------------------
#'      7  |   |   |   |   |   |   |   |   |
#'      | ---------------------------------
#'      6  |   |   |   |   |   |   |   |   |
#'      | ---------------------------------
#'      5  |   |   |   |   |   |   |   |   |
#'      | ---------------------------------
#'      4  |   |   |   |   |   |   |   |   |
#'      | ---------------------------------
#'      3  |   |   |   |   |   |   | Q |   |    Hàng th??? 3, c???t th??? 7
#'      | --------------------------------- 
#'      2  |   |   |   | Q |   |   |   |   |    Hàng th??? 2, c???t th??? 4
#'      | ---------------------------------
#'      1  | Q |   |   |   |   |   |   |   |    Hàng th??? 1, c???t th??? 1
#'      | 
#'      0____1___2___3___4___5___6___7___8 (Hàng)
#'
#' K???t qu??? tr??? v??? danh sách trong dó m???i ph???n t??? là m???t vecto g???m 8 s??? nguyên chính là m???t gi???i pháp cho bài toán 8 quân h???u
#' 
#-----------------------------------------------------------------------------

place_queen <- function(queens=c()) { 
  
  # N???u có 8 quân h???u du???c d???t, thì dây ph???i là m???t gi???i pháp.
  if (length(queens) == 8) {
    return(list(queens))
  }
  
  # Tìm ra noi quân h???u có th??? du???c d???t ??? hàng ti???p theo.
  # B??? t???t c??? các c???t dã du???c l???y
  # vì không th??? d???t m???t quân h???u bên du???i m???t quân h???u hi???n có
  possible_placements <- setdiff(1:8, queens)
  
  # D???i v???i m???i quân h???u dã có trên bàn c???
  # Hãy tìm các v??? trí du???ng chéo mà nó có th??? nhìn th???y trong hàng này.
  diag_offsets <- seq.int(length(queens), 1)
  diags <- c(queens + diag_offsets, queens - diag_offsets)
  diags <- diags[diags > 0 & diags < 9]
  
  # Th??? các c???t du???ng chéo này kh???i các v??? trí có th??? có
  possible_placements <- setdiff(possible_placements, diags)
  
  # D???i v???i m???i v??? trí có th???, hãy th??? và d???t m???t quân h???u
  possible_placements %>% 
    map(~place_queen(c(queens, .x))) %>%
    keep(~length(.x) > 0) %>%
    flatten()
}


# L???p m???t gi???i pháp duy nh???t
# M???t vecto g???m 8 s??? nguyên cho v??? trí c???t c???a 8 hoàng h???u
plot_single_8queens <- function(queens, title = NULL) {
  queens_df <- tibble(cols = queens, rows=1:8)
  board_df <- expand.grid(cols = 1:8, rows = 1:8) %>% 
    mutate(check = (cols + rows) %%2 == 1)
  
  p <- ggplot(queens_df, aes(rows, cols)) + 
    geom_tile(data=board_df, aes(fill=check), colour='black') +
    geom_text(label='\u2655', family="Arial Unicode MS", size = 8) + 
    theme_void() + 
    coord_equal() + 
    scale_fill_manual(values = c('TRUE'='white', 'FALSE'='grey70')) + 
    theme(
      legend.position = 'none'
    ) 
  
  if (is.null(title)) {
    p <- p + labs(title = paste("Queens:", deparse(as.numeric(queens)))) 
  } else {
    p <- p + labs(title = title)
  }
}




solutions <- place_queen()
v=1:8
f=function(q){L=length(q)
if(L==8){q}else{flatten(map(setdiff(v,c(q,q+L:1,q-L:1)),~f(c(q,.))))}}
s=data.frame(c=unlist(f(c())),r=v,x=rep(1:92,e=8),z=3)
b=mutate(crossing(c=v,r=v),z=(c+r)%%2)
g=geom_tile
ggplot(s,aes(r,c,fill=z))+g(d=b)+g()+facet_wrap(~x)